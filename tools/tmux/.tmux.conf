unbind r
bind-key -r r source-file ~/.tmux.conf

bind-key y select-pane -L
bind-key h select-pane -D
bind-key a select-pane -U
bind-key e select-pane -R

# Split panes
unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# ============================================================================
# SESSION MANAGEMENT
# ============================================================================

# Create new session with prefix + S
bind S command-prompt -p "New session:" "new-session -A -s '%%'"

# Kill current session with prefix + X
bind X confirm-before -p "kill-session #S? (y/n)" kill-session

# Switch to last session with prefix + L
bind L switch-client -l

# Don't exit tmux when closing a session (switch to another instead)
set -g detach-on-destroy off

# Автоматическое именование новых сессий по названию директории
set-hook -g session-created "rename-session '#{b:pane_current_path}'"

set -g prefix C-s
set -g mouse on
set -g set-clipboard on
set -g history-limit 1000000

# ============================================================================
# NOTIFICATIONS
# ============================================================================

# Monitor activity in other windows (long commands finishing, etc)
set -g monitor-activity off
set -g visual-activity off
set -g activity-action none

# Monitor bell signals in other windows
set -g monitor-bell off
set -g visual-bell off
set -g bell-action none

# for neovim
set -sg escape-time 0
set -g focus-events on

# VI mode
set-window-option -g mode-keys vi
set -g status-keys vi

# Статус-бар
set -g status on
# set -g status off

set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

set -g status-interval 1
set -g status-position top
set -g status-justify left
set -g status-style bg=default

# Статус-бар (левая часть)
set -g status-left ''

# Статус-бар (правая часть) - показываем имя сессии и время
set -g status-right '#{?client_prefix,#[fg=colour10],#[fg=colour12]}#S #[fg=colour242]| #[fg=default]%H:%M '

# Активное окно
set -g window-status-current-format " ●#{?#{||:#{==:#{window_index},3},#{||:#{==:#{window_index},6},#{==:#{window_index},9}}}, ,}"
set -g window-status-current-style fg=colour9,bg=default

# Неактивные окна
set -g window-status-format " ●#{?#{||:#{==:#{window_index},3},#{||:#{==:#{window_index},6},#{==:#{window_index},9}}}, ,}"
set -g window-status-style fg=colour242,bg=default

# Подсветка окон с активностью (когда команда завершилась)
# set -g window-status-activity-style fg=colour166,bg=default,bold

# Разделитель панелей
set -g pane-border-style fg=colour242
set -g pane-active-border-style fg=colour166

# Сообщения
set -g message-style fg=colour166,bg=default

# Режим выделения (copy-mode) - инверсия цветов терминала
set -g mode-style reverse

# Переменование окон
set -g automatic-rename on
set -g automatic-rename-format '#{b:pane_current_path}'

# Terminal colors
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"

# ============================================================================
# AUTO-SAVE SESSIONS (requires TPM + plugins)
# ============================================================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @continuum-restore 'on'              # восстанавливать при запуске
set -g @continuum-save-interval '15'        # сохранять каждые 15 минут
set -g @resurrect-capture-pane-contents 'off'

run '~/.tmux/plugins/tpm/tpm'
